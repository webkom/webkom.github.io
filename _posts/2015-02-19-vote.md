---
layout: post
title: vote optimizes the election
author: ekmartin

---

Da det er flere år siden Webkom har hatt et medlem som Abakusleder var det i fjor på tide å digitalisere stemmeprosessen på Genfors.
Det ble derimot lite med juks, og vi så oss derfor pent nødt til å lage hele greia på nytt. Det gikk likevel ikke veien denne gangen heller,
da kildekoden til prosjektet plutselig skulle gjøres tilgjengelig for alle.
Sikrere skulle det visst også bli, så da var det vel bare å ta til takke med at ærlighet varer lengst.

![GitHub](/images/posts/2015-02-20-vote-opensource.png)

Fra spøk til alvor er prosjektet nå klart til lansering og tilgjenglig på [GitHub](https://github.com/webkom/vote).
I motsetning til i fjor står vote nå på egne ben, og er helt uavhengig av [abakus.no](https://abakus.no).
Stemmesystemet er et av temaene på [diskusjonskvelden](https://abakus.no/event/1558-diskusjonskveld/) i dag (fredag den 20.), og her vil det også holdes en demoavstemning.
Dersom du finner feil i systemet kan dette gjerne tas opp da, via en issue på [GitHub](https://github.com/webkom/vote/issues), eller
 på mail til [webkom@abakus.no](webkom@abakus.no).

Selv om sikkerhet har stått i fokus under utviklingsprosessen har også målet om å oppnå en bra brukeropplevelse vært sentralt.
vote er designet med responsivitet i tankene og skal dermed fungere optimalt på mobile enheter. Det skal være enkelt
å stemme, med så få manuelle handlinger som mulig. Nye avstemninger lastes inn automatisk, og brukeren blir plassert rett inn i listen med alternativer.

![vote](/images/posts/2015-02-20-vote-screenshot.png)

Det å spare tid har alltid vært hovedmålet med et digitalt stemmesytem. Ved papirstemming går mye tid med på innhenting og opptelling av stemmer, noe du naturligvis slipper i et digitalt system. Likevel er det også mye tid som kan gå tapt på prosessen rundt stemmesystemet, og det å gjøre denne så smidig som mulig har vært et viktig mål. Et av forbedringsforslagene på forrige diskusjonskveld var å gi hver bruker et nøkkelkort, som de så kan bruke når de skal gå inn og ut av lokalet. Dette gjør jobben enklere for de ansvarlige og passer på at kun tilstedeværende kan stemme.

## Implementasjon
vote er skrevet i Node.js, med den såkalte MEAN-stacken. Dette innebærer at [MongoDB](http://www.mongodb.com/), [Express](http://expressjs.com/) og [AngularJS](https://angularjs.org/) har blitt tatt i bruk. Express gjør det enkelt å sette opp API-er i Node, og dette fungerer bra sammen med [ensidesrammeverk](https://en.wikipedia.org/wiki/Single-page_application) som AngularJS. Som et ekstra lag oppå databasen brukes [Mongoose](mongoosejs.com), som gjør valideringer og lignende enkelt.

## Tester
Selvom gode tester alltid står i fokus for Webkomprosjekter har det kanskje vært et ekstra viktig arbeidsområde for vote. Med en testdekning tilnærmet lik 100% minker sannsynligheten for uventede hendelser, samtidig som det legger til rette for en sentral definisjon av prosjektets funksjonalitet.

Da vote har en adskilt frontend og backend har det også vært en utfordring å opprettholde tester for begge deler. Dette har resultert i hovedsakelig to typer tester: API-tester mot serveren, samt ende-til-ende tester i nettleseren.

Ved å ta i bruk [supertest](https://github.com/tj/supertest) og [mocha](https://github.com/mochajs/mocha) til API-testene kan de ulike endepunktenes ønskede returverdier enkelt sjekkes ([kilde](https://github.com/webkom/vote/blob/8032864b0c741ccf89386156a7e5195d36a66766/test/api/vote.test.js#L171)):
```js
it('should not be possible to vote without logging in', function(done) {
    passportStub.logout();
    request(app)
        .post('/api/vote')
        .send(votePayload(this.activeAlternative.id))
        .expect(401)
        .expect('Content-Type', /json/)
        .end(function(err, res) {
            if (err) return done(err);

            var error = res.body;
            error.status.should.equal(401);
            error.message.should.equal('You need to be logged in to access this resource.');
            done();
        });
});
```

Det å teste frontendkoden, altså det som kjøres i nettleseren, er litt vanskeligere. Dette gjøres med [Protractor](http://angular.github.io/protractor/#/), for å sjekke at nettsiden reagerer på riktig måte når f.eks. en bruker trykker på et alternativ og prøver å stemme. Her tar vi også i bruk [cucumber-js](https://github.com/cucumber/cucumber-js), som lar oss definere frontend-funksjonalitet på følgende måte ([kilde](https://github.com/webkom/vote/blob/8032864b0c741ccf89386156a7e5195d36a66766/features/admin.feature#L24)):

```cucumber
Scenario: Add alternatives
  Given There is an inactive election
  And I am on the edit election page
  When I enter a new alternative "Alternative"
  And I click "Legg til alternativ"
  Then I should see the alternative "Alternative"
```

Hver av setningene hører så til et steg i testen, som du kan se [her](https://github.com/webkom/vote/blob/master/features%2Fstep_definitions%2FadminSteps.js). Testene vil så kunne kjøres i en faktisk nettleser:

![frontend tests](/images/posts/2015-02-20-vote-frontend.gif)

## Bidrag

Det er fortsatt to uker igjen til Generalforsamlingen går av stabelen, og vi tar gjerne i mot pull-requests dersom du har forbedringsforslag. For å gjøre dette må du lage en fork av [prosjektet](https://github.com/webkom/vote) - les mer [her](https://help.github.com/articles/fork-a-repo/). Send oss en mail på [webkom@abakus.no](webkom@abakus.no) dersom du lurer på noe!
